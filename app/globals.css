@tailwind base;
@tailwind components;
@tailwind utilities;

/* KaTeX styles for math rendering */
@import "katex/dist/katex.min.css";
/* Highlight.js styles for code syntax highlighting */
@import "highlight.js/styles/github-dark.css";

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96%;
    --secondary-foreground: 222.2 84% 4.9%;
    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Custom styles for better dark theme experience */
body {
  background-color: #000000;
  color: #f9fafb;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* Improved text handling */
.break-words {
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
}

.hyphens-auto {
  hyphens: auto;
}

/* Line clamping utility */
.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Tabular numbers for consistent number alignment */
.tabular-nums {
  font-variant-numeric: tabular-nums;
}

/* Enhanced code block styling for proper indentation and dark theme */
pre {
  background-color: #1f2937 !important;
  border: 1px solid #374151;
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1rem 0;
  overflow-x: auto;
  white-space: pre;
  font-family: 'Fira Code', 'Monaco', 'Cascadia Code', 'Roboto Mono', 'Consolas', monospace;
  font-size: 0.875rem;
  line-height: 1.5;
  color: #f9fafb;
  box-shadow:
    0 1px 3px 0 rgba(0, 0, 0, 0.12),
    0 1px 2px -1px rgba(0, 0, 0, 0.1);
  position: relative;
}

pre code {
  background: none !important;
  border: none !important;
  padding: 0 !important;
  margin: 0 !important;
  font-size: inherit;
  color: inherit;
  white-space: pre;
  word-wrap: normal;
  overflow-wrap: normal;
  word-break: normal;
  font-family: inherit;
}

/* Inline code styling (different from pre code) */
:not(pre) > code {
  background-color: #374151 !important;
  color: #f9fafb !important;
  padding: 0.125rem 0.375rem !important;
  border-radius: 0.25rem !important;
  font-size: 0.875rem !important;
  font-family:
    'Fira Code', 'Monaco', 'Cascadia Code', 'Roboto Mono', 'Consolas', monospace !important;
  border: 1px solid #4b5563 !important;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Custom syntax highlighting classes */
.code-keyword {
  color: #569cd6;
  font-weight: 600;
}

.code-comment {
  color: #6a9955;
  font-style: italic;
}

.code-string {
  color: #ce9178;
}

.code-number {
  color: #b5cea8;
}

.code-class-name {
  color: #4ec9b0;
  font-weight: 500;
}

.code-function {
  color: #dcdcaa;
  font-weight: 500;
}

.code-operator {
  color: #d4d4d4;
}

.code-punctuation {
  color: #d4d4d4;
}

.code-variable {
  color: #9cdcfe;
}

.code-type {
  color: #4ec9b0;
}

/* Language-specific styling */
.language-java,
.language-pseudocode {
  position: relative;
}
.language-javascript,
.language-python {
  position: relative;
}

/* Enhanced KaTeX styling for dark theme - Fixed \neq rendering */
.katex {
  color: #f9fafb;
  font-size: 1.1em;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.katex * {
  color: #f9fafb;
}

.katex .base {
  color: #f9fafb;
}

.katex .mord,
.katex .mrel,
.katex .mbin,
.katex .mop,
.katex .mopen,
.katex .mclose,
.katex .mpunct,
.katex .minner {
  color: #f9fafb;
}

/* Specific fix for \neq and other relation symbols */
.katex .mrel {
  color: #f9fafb !important;
}

.katex-display {
  margin: 1.5rem 0;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 0.5rem 0;
  text-align: center;
}

.katex-display .katex {
  display: inline-block;
  text-align: center;
}

.katex-inline {
  padding: 0 0.15em;
}

/* Ensure proper scrolling for long code lines */
pre::-webkit-scrollbar {
  height: 8px;
}

pre::-webkit-scrollbar-track {
  background: #374151;
  border-radius: 4px;
}

pre::-webkit-scrollbar-thumb {
  background: #6b7280;
  border-radius: 4px;
}

pre::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}

/* Enhanced Markdown styling */
.prose strong {
  color: #f9fafb;
  font-weight: 700;
}

.prose em {
  color: #f9fafb;
  font-style: italic;
}

.prose ul {
  list-style-type: disc;
  margin-left: 1.5rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}

.prose ol {
  list-style-type: decimal;
  margin-left: 1.5rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}

.prose li {
  margin-bottom: 0.25rem;
  color: #f9fafb;
}

.prose table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin: 1.5rem 0;
  border: 1px solid #374151;
  border-radius: 0.75rem;
  overflow: hidden;
  background-color: rgba(17, 24, 39, 0.75);
}

.prose thead tr {
  background: linear-gradient(135deg, rgba(30, 64, 175, 0.35), rgba(6, 95, 70, 0.25));
}

.prose th,
.prose td {
  padding: 0.85rem 1rem;
  text-align: left;
  vertical-align: top;
  border-bottom: 1px solid rgba(55, 65, 81, 0.75);
  color: #f9fafb;
}

.prose tbody tr:nth-child(odd) {
  background: rgba(17, 24, 39, 0.65);
}

.prose tbody tr:nth-child(even) {
  background: rgba(12, 20, 33, 0.65);
}

.prose tbody tr:hover {
  background: rgba(30, 64, 175, 0.25);
}

.prose tbody tr:last-child td {
  border-bottom: none;
}

.prose th code,
.prose td code {
  background-color: rgba(55, 65, 81, 0.65);
  border-radius: 0.375rem;
  padding: 0.1rem 0.4rem;
}

/* Enhanced interactive element feedback */
.transition-all {
  transition-property: all;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 200ms;
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  /* Disable all animations and transitions */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  /* Specifically target Tailwind animation classes */
  .animate-bounce,
  .animate-pulse,
  .animate-ping,
  .animate-spin {
    animation: none !important;
  }

  /* Disable hover scale animations */
  .hover\:scale-105:hover {
    transform: none !important;
  }

  .hover\:scale-110:hover {
    transform: none !important;
  }

  .active\:scale-95:active {
    transform: none !important;
  }

  .active\:scale-\[0\.99\]:active {
    transform: none !important;
  }

  /* Disable transform transitions */
  .transition-transform {
    transition: none !important;
  }

  /* Keep color transitions for better UX */
  .transition-colors {
    transition-duration: 0.01ms !important;
  }

  /* Disable motion-based transitions but keep essential ones */
  .transition-all {
    transition-property:
      color, background-color, border-color, text-decoration-color, fill, stroke !important;
    transition-duration: 0.01ms !important;
  }

  /* Disable duration-based transitions */
  .duration-75,
  .duration-100,
  .duration-150,
  .duration-200,
  .duration-300,
  .duration-500,
  .duration-700,
  .duration-1000 {
    transition-duration: 0.01ms !important;
  }
}

/* Custom scrollbar for dark theme */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #1f2937;
}

::-webkit-scrollbar-thumb {
  background: #4b5563;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* Enhanced focus styles for accessibility */
button:focus-visible,
[role='button']:focus-visible {
  @apply outline-none ring-2 ring-blue-500 ring-offset-2 ring-offset-gray-900;
}

/* Enhanced button states */
button:active {
  transform: scale(0.98);
}

button:disabled {
  transform: none;
  cursor: not-allowed;
}

/* Card and container shadows - enhanced for depth */
.shadow-xl {
  box-shadow:
    0 10px 15px -3px rgba(0, 0, 0, 0.3),
    0 4px 6px -2px rgba(0, 0, 0, 0.2);
}

.shadow-lg {
  box-shadow:
    0 8px 12px -2px rgba(0, 0, 0, 0.25),
    0 3px 5px -3px rgba(0, 0, 0, 0.15);
}

.shadow-md {
  box-shadow:
    0 4px 6px -1px rgba(0, 0, 0, 0.2),
    0 2px 4px -1px rgba(0, 0, 0, 0.12);
}

.shadow-sm {
  box-shadow:
    0 1px 3px 0 rgba(0, 0, 0, 0.12),
    0 1px 2px -1px rgba(0, 0, 0, 0.1);
}

/* Improved responsive grid for chapters */
.auto-rows-fr {
  grid-auto-rows: 1fr;
}

/* Prose styling for better text rendering */
.prose {
  max-width: none;
}

.prose p {
  margin-bottom: 1rem;
  line-height: 1.7;
  color: #f9fafb;
}

.prose code {
  @apply rounded border border-gray-700/50 bg-gray-800 px-1.5 py-0.5 font-mono text-sm text-gray-100;
}

.prose pre {
  @apply overflow-x-auto rounded border border-gray-700/50 bg-gray-800 p-4 text-gray-100;
}

/* Ensure proper text wrapping in all contexts */
* {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Prevent layout shift with consistent spacing */
.space-y-3 > * + * {
  margin-top: 0.75rem;
}

.space-y-4 > * + * {
  margin-top: 1rem;
}

.space-y-6 > * + * {
  margin-top: 1.5rem;
}

/* Improved button text handling */
button {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Ensure flex items don't overflow */
.flex {
  min-width: 0;
}

.flex-1 {
  min-width: 0;
}

/* Grid improvements for better alignment */
.grid {
  gap: 1rem;
}

/* Responsive text sizing */
@media (max-width: 640px) {
  .text-2xl {
    font-size: 1.5rem;
    line-height: 2rem;
  }

  .text-lg {
    font-size: 1.125rem;
    line-height: 1.75rem;
  }

  pre {
    padding: 0.75rem;
    font-size: 0.8rem;
    margin: 0.75rem 0;
  }

  .language-java::before,
  .language-pseudocode::before {
    font-size: 0.7rem;
    padding: 0.1rem 0.375rem;
  }
}

/* Improved card layout */
.card-content {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Better handling of long content */
.max-w-none {
  max-width: none;
}

/* Ensure proper spacing in flex layouts */
.gap-2 {
  gap: 0.5rem;
}

.gap-3 {
  gap: 0.75rem;
}

.gap-4 {
  gap: 1rem;
}

/* Enhanced hover effects for interactive elements */
.hover\:shadow-md:hover {
  box-shadow:
    0 4px 6px -1px rgba(0, 0, 0, 0.2),
    0 2px 4px -1px rgba(0, 0, 0, 0.12);
}

/* Color-specific shadow effects */
.shadow-green-900\/20 {
  box-shadow:
    0 1px 3px 0 rgba(20, 83, 45, 0.2),
    0 1px 2px -1px rgba(20, 83, 45, 0.1);
}

.shadow-red-900\/20 {
  box-shadow:
    0 1px 3px 0 rgba(127, 29, 29, 0.2),
    0 1px 2px -1px rgba(127, 29, 29, 0.1);
}

.shadow-blue-900\/20 {
  box-shadow:
    0 1px 3px 0 rgba(30, 58, 138, 0.2),
    0 1px 2px -1px rgba(30, 58, 138, 0.1);
}

/* Focus ring colors for different button variants */
.focus-visible\:ring-green-500:focus-visible {
  --tw-ring-color: rgb(34 197 94);
}

.focus-visible\:ring-red-500:focus-visible {
  --tw-ring-color: rgb(239 68 68);
}

.focus-visible\:ring-purple-500:focus-visible {
  --tw-ring-color: rgb(168 85 247);
}

.focus-visible\:ring-orange-500:focus-visible {
  --tw-ring-color: rgb(249 115 22);
}

.focus-visible\:ring-gray-500:focus-visible {
  --tw-ring-color: rgb(107 114 128);
}

/* Array Visualization Styles */
.array-visualization {
  display: flex;
  flex-direction: row;
  margin: 1.5rem 0;
  overflow-x: auto;
  padding: 0.5rem;
  border: 2px solid #374151;
  border-radius: 0.5rem;
  background-color: #1f2937;
  width: fit-content;
  max-width: 100%;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
}

.array-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-width: 48px;
  max-width: 80px;
  box-sizing: border-box;
  border-right: 1px solid #4b5563;
  background-color: #374151;
  transition: background-color 0.2s ease;
}

.array-item:last-child {
  border-right: none;
}

.array-item:hover {
  background-color: #4b5563;
}

.array-item-index {
  font-size: 0.75rem;
  color: #9ca3af;
  padding: 4px 8px 2px 8px;
  width: 100%;
  text-align: center;
  box-sizing: border-box;
  border-bottom: 1px solid #4b5563;
  background-color: #1f2937;
  font-weight: 600;
  font-family: 'Courier New', monospace;
}

.array-item-value {
  font-family: 'Courier New', monospace;
  font-weight: 700;
  color: #f9fafb;
  padding: 8px 6px;
  width: 100%;
  text-align: center;
  box-sizing: border-box;
  font-size: 0.9rem;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Ensure proper text wrapping in array cells */
.array-item-value,
.array-item-index {
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* Mermaid Diagram Enhancements */
.mermaid {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 1.5rem 0;
  padding: 1rem;
  background-color: #1f2937;
  border: 1px solid #374151;
  border-radius: 0.5rem;
  overflow-x: auto;
  min-height: 200px;
}

.mermaid svg {
  max-width: 100%;
  height: auto;
  background-color: transparent;
}

/* Dark theme specific Mermaid overrides */
.mermaid .node rect,
.mermaid .node circle,
.mermaid .node ellipse,
.mermaid .node polygon {
  fill: #374151 !important;
  stroke: #9ca3af !important;
  stroke-width: 2px !important;
}

.mermaid .node .label {
  color: #f9fafb !important;
  fill: #f9fafb !important;
  font-family: inherit !important;
  font-size: 14px !important;
}

.mermaid .edgePath .path {
  stroke: #9ca3af !important;
  stroke-width: 2px !important;
}

.mermaid .edgeLabel {
  background-color: #1f2937 !important;
  color: #f9fafb !important;
  fill: #f9fafb !important;
  font-family: inherit !important;
}

/* Accept state styling for FSMs */
.mermaid .node.acceptState rect,
.mermaid .node.acceptState circle {
  fill: #065f46 !important;
  stroke: #10b981 !important;
  stroke-width: 3px !important;
}

.mermaid .node.acceptState .label {
  color: #d1fae5 !important;
  fill: #d1fae5 !important;
  font-weight: 600 !important;
}

/* Start state styling */
.mermaid .node.startState rect,
.mermaid .node.startState circle {
  fill: #1e40af !important;
  stroke: #3b82f6 !important;
  stroke-width: 3px !important;
}

.mermaid .node.startState .label {
  color: #dbeafe !important;
  fill: #dbeafe !important;
  font-weight: 600 !important;
}

/* Responsive design for arrays */
@media (max-width: 640px) {
  .array-visualization {
    margin: 1rem 0;
    padding: 0.25rem;
  }

  .array-item {
    min-width: 40px;
    max-width: 60px;
  }

  .array-item-index {
    font-size: 0.7rem;
    padding: 2px 4px 1px 4px;
  }

  .array-item-value {
    font-size: 0.8rem;
    padding: 6px 4px;
    min-height: 28px;
  }

  .mermaid {
    padding: 0.5rem;
    margin: 1rem 0;
  }
}

/* Enhanced scrollbar for array visualization */
.array-visualization::-webkit-scrollbar {
  height: 8px;
}

.array-visualization::-webkit-scrollbar-track {
  background: #1f2937;
  border-radius: 4px;
}

.array-visualization::-webkit-scrollbar-thumb {
  background: #4b5563;
  border-radius: 4px;
}

.array-visualization::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* Ensure proper spacing and alignment */
.array-visualization .array-item:first-child {
  border-top-left-radius: 0.25rem;
  border-bottom-left-radius: 0.25rem;
}

.array-visualization .array-item:last-child {
  border-top-right-radius: 0.25rem;
  border-bottom-right-radius: 0.25rem;
}
